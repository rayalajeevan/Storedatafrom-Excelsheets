<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JOBS COUNT</title>
    <style>
input[type=text],select {
  width: 60%;
  padding: 12px 20px;height: 8px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
input[type=file]{
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}
input[type=date],select{
  width: 50%;
  padding: 12px 20px;height: 8px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit]{
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

div {
  border-radius: 2px;
  background-color: #f2f2f2;
  padding: 10px;
    height: 50px;width: 250px;
}
#companydata {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

#companydata td, #companydata th {
  border: 1px solid #ddd;
  padding: 8px;
}

#companydata tr:nth-child(even){background-color: #f2f2f2;}

#companydata tr:hover {background-color: #ddd;}

#companydata th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align:left;
  background-color: #4CAF50;
  color: white;
}
#uploaddata1 th {
  padding-top: 12px;
  padding-bottom: 12px;
  padding-right: 15px;
  padding-left: 15px;
  text-align:left;
  background-color: #4CAF50;
  color: white;
}
#uploaddata1 td, #uploaddata1 th {
  border: 1px solid #ddd;
  padding: 12px;
}
#companydata {
  font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 100%;
}
         table.center {
    margin-left:auto;
    margin-right:auto;
  }

</style>
<script>
function testedstatuschange(val)
{let elm_id=document.getElementById(val.id);
  if (elm_id.value=="Change To Test Completed...?"){
  var req_obj=new XMLHttpRequest()
  var req=req_obj.open('GET','http://'+localStorage.getItem('ip')+':7000/change_tested_status?tested_status=True&info_id='+val.className)
  req_obj.onreadystatechange=function(){
    if (this.status==200 & this.readyState==4){
      var json_obj=JSON.parse(this.responseText)
      let id=val.id

      let dater=document.getElementById(id.toString());
      dater.value="Test Completed"
      elm_id.style.backgroundColor=""
      dater.disabled=true;

    }
    if(this.status>=300 && this.status<=599){
      alert("SomeThing Went Wrong Try Agian.....")
    }
  }
  req_obj.send()
}
else
{
alert("If its sure then Click Again")
elm_id.value="Change To Test Completed...?"
elm_id.style.backgroundColor="red"
}



}
</script>
</head>
<body>
<input type="submit" value="Total Companies   {{ count }}">
<a onclick="return showbugs()"><strong>Show Bugs</strong></a>|
  &nbsp;<a  onclick=" return logout()" align='right'><strong>Logout</strong></a>
<form action="/viewjobscount/" method="GET" >
    <table>
        <tr>
            <td>
                <div style="background-color: white">
                </div>
            </td>
            <td>
                <div>
    <span>Search By date</span><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="date"  onfocus="(this.type='date')" placeholder="YYYY-DD-MM">
                </div> </td><td><div>
    <span>Search By ScrappedBy</span><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select name='scrappedBy' id='intern'>
    <option value="select">------------------------------Select-----------------------</option>

    <option value="anusha">Anusha</option>
    <option value="Sowmya">Sowmya</option>
    <option value="Manisha">Manisha</option>
    <option value="Rasika">Rasika</option>
    <option value="Pravalika">Pravalika</option>
    <option value="Ravali.D">Ravali.D</option>
    <option value="Prasad">Prasad</option>
    <option value="Ravali">Ravali</option>
    <option value="Santhi sudha">Santhi sudha</option>
     <option value="aravindh">aravindh</option>
      <option value="mounika">mounika</option>
      <option value="Rohit">Rohit</option>
      <option value="madhu">madhu</option>
      <option value="Himavarshini">Himavarshini</option>
      <option value="Gopichand">Gopichand</option>
        </select></div>
        </td>
        </tr>
    </table>

  <input type="submit" value="Search">

</form>
<table id='cdata'><tr>
  <td style="text-align:left">
<h5 id="show"></h5></td>
<td align="right">
<h5 id='0'  text-align="right"  class="pageNation" ><font size='3px' color="green"> &nbsp;&nbsp;<a href="http://{{ ip }}:7000/viewjobscount/?startrow={{ start }}">         click here</font>   To see another 10</h5>
</td>
</tr>
</table>
<label id='lb'></label>
<table id="companydata" align="center">
  <tr>
    <th>Company_name</th>
    <th>company_info_id</th>
    <th>jobs</th>
      <th>Interns</th>
      <th>ScrappedBY</th>
      <th>Test Status</th>
  </tr>
    {% for dic in data %}
        <tr>
            <td>{{  dic.CompanyName}}</td>
            <td><a id={{ dic.company_info_id }} onclick='return raiseBug(this)'>{{  dic.company_info_id }}</td>
            <td>{{ dic.jobscount }}</td>
            <td>{{ dic.internscount }}</td>
            <td>{{ dic.scrap }}</td>
            {% ifequal dic.tested_status "False" %}
            <td><input type="button" value="Click Here If You tested..."  class="{{dic.company_info_id}}"id="{{ dic.company_info_id}}Butt" onclick='testedstatuschange(this)'></td>
            {% else %}
            <td><input type="button" value="Test Completed" disabled ></td>
            {% endifequal %}
            <input type="text" id="{{dic.company_info_id }}" value="{{ dic.scrap }}" style="display:none">
        </tr>
    {% endfor %}
</table>
<div id='BugRaise' style="display:none">
  <h3 align='center'>Raise Bug</h3>
  <form action="/RaiseBug/" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <label><strong>Assigned By</strong></label><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='text' name='assignby' placeholder="Assigned By" required><br>
  <label><strong>Company Info Id</strong></label><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='text' name='infoid' placeholder="company_info_id"  value="{{cid}}" required ><br>
  <label><strong>Assign to</strong></label><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select id='assignTo' name='assignTo' required>

  </select>
  <br>
  <label><strong>Bug Image Upload</strong></label><br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <input type="file" name='bug_image' width="200px" id="imgInp" accept="image/png" >
<br>    <table>
    <tr>
      <td>
  <label><strong>Bug description</strong></label><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name='Bugdesc' style="margin: 0px; width: 768px; height: 199px;" required >{{ bugdesc}}</textarea></td><td>
  <span id="bugimg" style="display:none">
  <img id="blah" src="#" alt="your image" width="500" height="280" /></span></td>
</tr></table>
<input type='submit' value='RaiseBug' onclick="return checksession()">
</form>
</div>
</body>
<script>
var ipr="{{ ip}}"
if (ipr!=""){
  localStorage.setItem('ip',ipr)
}


function raiseBug(the){
  var infoid=the.id
  let user=localStorage.getItem('user')
  if (user=="sudha99"){
    user=" Santhi sudha"
  }
  document.querySelectorAll('input[name=assignby]')[0].value=user
  document.querySelectorAll('input[name=infoid]')[0].value=infoid
  document.getElementById('companydata').style.display = "none";
  document.getElementById('BugRaise').style.display = "block";
  document.querySelectorAll('input[name=infoid]')[0].value
  var select=document.getElementById('assignTo')
  var assnto=document.getElementById(the.id).value
  select.options[select.options.length] = new Option("----------"+assnto+"-------",assnto);
  select.options[select.options.length] = new Option("----------jeevan-------","jeevan");
}
function showbugs(){
  location.href="http://"+localStorage.getItem('ip')+":7000/showbugs/"
}
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript">
var ipr="{{ ip }}"
if (ipr!=""){
  ip="{{ ip}}"
}
var status="{{ status}}"
if (status!=""){
  location.href="http://"+ip+":7000/showbugs"
}
if (localStorage.getItem('user')!=null){
  document.getElementById('companydata').style.display = "block";

  document.getElementById('BugRaise').style.display = "none";
}
else{
  location.href="http://"+localStorage.getItem('ip')+":7000/BugsDashBoard/"
}

function logout(){
  localStorage.removeItem('user')
  location.href="http://"+localStorage.getItem('ip')+":7000/BugsDashBoard/"
}
function checksession(){
  if(document.getElementById('assignTo').value=="select")
      {
        alert("please select one Intern")
        return false
      }
    if (localStorage.getItem('user')==null){
      alert("session Expired please click refresh")
      return false
}
}
function readURL(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    document.getElementById('bugimg').style.display="block";
    reader.onload = function(e) {
      $('#blah').attr('src', e.target.result);
    }

    reader.readAsDataURL(input.files[0]);
  }
}

$("#imgInp").change(function() {
  readURL(this);
});
var Notificationdata;
function getNotification()
{

var xhttp = new XMLHttpRequest();
if (localStorage.getItem('noti')!=null){
var req=xhttp.open('GET',"http://"+localStorage.getItem('ip')+":7000/bugnotification?bugid="+localStorage.getItem('noti'))
}
else{
var req=xhttp.open('GET',"http://"+localStorage.getItem('ip')+":7000/bugnotification?bugid=14")
}
xhttp.onreadystatechange = function() {
 if(this.status==200 && this.readyState==4)
 {
   Notificationdata=JSON.parse(this.responseText)
   if (Notificationdata["data"]!=5){
         if(localStorage.getItem('noti')==null){
           localStorage.setItem('noti',14)
           localStorage.setItem(localStorage.getItem('noti'),JSON.stringify(Notificationdata))
         }
         else if (parseInt(Notificationdata["data"]["bugid"])>parseInt(localStorage.getItem('noti'))){
           localStorage.setItem('noti',Notificationdata["data"]["bugid"])
           localStorage.setItem(localStorage.getItem('noti'),JSON.stringify(Notificationdata))
           let assignby =JSON.parse(localStorage.getItem(localStorage.getItem('noti')))["data"]["Bug_assigned_by"]
           let assignto=JSON.parse(localStorage.getItem(localStorage.getItem('noti')))["data"]["Bug_assigned_to"]
           var notification = new Notification('Scrapping BugRaised', {
             icon: 'https://d2.alternativeto.net/dist/icons/octoparse_112785.png?width=200&height=200&mode=crop&upscale=false',
             body: 'Hii '+assignby+' rasied bug  on '+assignto});
     }

   }
   else{
     localStorage.setItem('noti',parseInt(localStorage.getItem('noti'))+1)
   }
 }
 if (this.status>=400 && this.status<=600 && this.readyState==4){
   return  897
 }
}

xhttp.send()
}


// setInterval(function () { getNotification(); }, 15000);;
</script>
</html>
